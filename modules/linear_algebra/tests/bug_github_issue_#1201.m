%=============================================================================
% Copyright (c) 2017 Allan CORNET (Nelson)
%=============================================================================
% This file is part of the Nelson.
%=============================================================================
% LICENCE_BLOCK_BEGIN
% SPDX-License-Identifier: LGPL-3.0-or-later
% LICENCE_BLOCK_END
%=============================================================================
% <-- Issue URL -->
% https://github.com/nelson-lang/nelson/issues/1201
% <-- Short Description -->
% Matrix Exponential (expm) might give wrong results
%=============================================================================
format long g
a = 2e10;
b = 4e8/6;
c = 200/3;
d = 3;
e = 1e-8;
A = [0, e, 0; -(a+b), -d, a; c, 0, -c];
R = expm(A);
REF = [         0.446849468283193      1.54044157383956e-09         0.462811453558787
-5743067.77948216       -0.0152830038686908         -4526542.71278667
0.447722977849512      1.54270484519595e-09         0.463480648837663];
assert_isapprox(R, REF, 1e-12);
%=============================================================================
M = [-0.1000   -0.2000   -0.3000    0.0100;
    0.0100         0         0         0;
         0    0.0100         0         0;
         0         0         0         0];
R = expm(M);
REF = [0.9039   -0.1917   -0.2854    0.0095;
    0.0095    0.9990   -0.0015    0.0000;
    0.0000    0.0100    1.0000    0.0000;
         0         0         0    1.0000];
assert_isapprox(R, REF, 1e-4);
%=============================================================================