%=============================================================================
% Copyright (c) 2023-present Allan CORNET (Nelson)
%=============================================================================
% This file is part of the Nelson.
%=============================================================================
% LICENCE_BLOCK_BEGIN
% SPDX-License-Identifier: LGPL-3.0-or-later
% LICENCE_BLOCK_END
%=============================================================================
skip_testsuite(~ismodule('slicot'), 'SLICOT is not installed');
%=============================================================================
A = [0.8000         0;  0.8000    1.0000];
B = [0.6000; 0.6000];
Q = [0     0; 0     1];
R = 1;
[K, S, e] = lqr(A, B, Q, R);

K_REF = [-0.0000    6.1623];
S_REF = [8.2164   -8.2164; -8.2164   18.4868];
e_REF = [-1.2649; -0.6325];

assert_isapprox(K, K_REF, 1e-4);
assert_isapprox(S, S_REF, 1e-4);
assert_isapprox(e, e_REF, 1e-4);
%=============================================================================
A = [-0.313 56.7 0; -0.0139 -0.426 0; 0 56.7 0];
B = [0.232; 0.0203; 0];
C = [0 0 1];
D = 1;
Ts = 1.2;
sys1 = ss(A, B, C, D, Ts);
sys2 = ss(A, B, C, D);

P = 2;
Q = P * C' * C;
R = 2;
[K1, S1, e1] = lqr(sys1, Q, R);

K1_REF = [-0.4606  -10.4369         0];
e1_REF = [ -0.2101 + 0.5186i; -0.2101 - 0.5186i;  0.0000 + 0.0000i];

assert_isapprox(K1, K1_REF, 1e-4);
assert_isapprox(e1, e1_REF, 1e-3);
%=============================================================================
[K2, S2, e2] = lqr(sys2, Q, R);

K2_REF = [-0.4451   37.8697    1.0000];
e2_REF = [  -0.1198 + 0.0000i;-0.6423 - 1.0335i;-0.6423 + 1.0335i];

assert_isapprox(K2, K2_REF, 1e-4);
assert_isapprox(e2, e2_REF, 1e-3);

%=============================================================================
